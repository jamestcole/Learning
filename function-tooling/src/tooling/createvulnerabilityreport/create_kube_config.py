from typing import Any

import boto3


def create_kube_config(token: str) -> dict[str, Any]:
    print("creating kube config using EKS token")
    eks_client = boto3.client("eks")
    cluster = eks_client.describe_cluster(name="test")["cluster"]
    return {
        "apiVersion": "v1",
        "clusters": [
            {
                "cluster": {
                    "certificate-authority-data": cluster['certificateAuthority']['data'],
                    "server": cluster['endpoint']
                },
                "name": "arn:aws:eks:eu-west-1:618281058848:cluster/test"
            }
        ],
        "contexts": [
            {
                "context": {
                    "cluster": "arn:aws:eks:eu-west-1:618281058848:cluster/test",
                    "user": "aws"
                },
                "name": "arn:aws:eks:eu-west-1:618281058848:cluster/test"
            }
        ],
        "current-context": "arn:aws:eks:eu-west-1:618281058848:cluster/test",
        "kind": "Config",
        "preferences": {},
        "users": [{
            "name": "aws",
            "user": {
                "token": token
            }
        }]
    }
